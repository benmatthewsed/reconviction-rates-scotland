---
title: "Understanding change in reconviction rates"
format: revealjs
output-dir: docs
---

## Introduction

- The crime drop has changed the demographics of people being convicted (cite: me; the one from EW; Farrell)
- This has downstream impacts on how we understand aggregate indicators of 'performance' in the criminal justice system

## People want to use reconviction rates as a performance metric

"The ability to compare and discuss trends in reoffending is important to its usefulness as a performance target within government" (NI stats)
- see equivalent from SG

- The logic is that if the reconviction rate goes down then the criminal justice system is doing a better job at rehabilitating offenders

- But, as NI statistics said: "differences in the offending related characteristics of those included in each cohort make comparing reoffending rates problematic, across both time and jurisdictions."

### What is your estimand?

- Basically, what theoretical thing are you trying to measure?
- A 'unit-specific quantity': at the individual level, what is the probability that a given person will be reconvicted?
- A 'target population': "over whom or what do we aggregate that unit-specific quantity"

- The annual reconviction rate aggregates over the population who could have been reconvicted in each year.

- Because of changes in the characteristics of the people who have been convicted change in the overall reconviction rate can be biased. The overall change we see will be both due to changes in the prevalence of reconviction amongst demographic groups, but also the mix/composition of those groups who are in each reconviction cohort.

- This is known.

- Previous approaches used an individual-level logistic regression approach to calculate 'predicted' reconviction rates.

- An alternative approach from demography is standardization and decomposition. This lets us separate out the contributions of changing demographics as well as changes in the sub-group reconviction rates to the overall rate.

- We use the methods proposed by Das Gupta (1993) as implemented in the `{dasguptr}` R package.

## Data

We explore change in reconviction rates in Scotland between 2004-2020. These are made available by SG as part of their Reconvictions Bulletin. We decompose the overall reconviction rate by age and sex. These are key demographic characteristics in relation to the crime drop in Scotland (Matthews and Minton 2018).
There is nothing particularly special about these time points, and the same approach would work for oither time periods.

Note: include a figure of the overall reconvictions rate here

Note: it's possible to get data back to 1997-98 with different age categories.

## Measures

- What actual measure do they use in Scotland?
- Age groups included
- Genders included


## Method

- Description of standardization and decomposition
- Draw from the vignettes?


## Results

```{r warnings=FALSE}

library(DasGuptR)
library(readxl)
library(here)
library(tidyverse)

scot_reconv <- read_xlsx(here("01_data",
                      "reconvictions-2020-21-offender-cohort-additional-datasets.xlsx"),
                 sheet = "AGdata",
                 skip = 4)

scot_reconv <- 
  scot_reconv |> 
  select(-...11:-...14) |> 
  select(-...1) |> 
  rename(la = ...2,
         year = ...3) |> 
  janitor::clean_names() |> 
  filter(la != "LA")

scot_reconv <- 
scot_reconv |> 
  filter(age != "All",
         gender != "All")



overall_res <- 
scot_reconv |> 
  group_by(year, gender, age) |> 
  summarise(number_of_offenders = sum(number_of_offenders),
            no_reconvicted = sum(no_reconvicted),
            number_of_reconvictions = sum(number_of_reconvictions),
            .groups = "drop") |> 
  mutate(
    prevalence = no_reconvicted/number_of_offenders,
    frequency = number_of_reconvictions/number_of_offenders,
  )

```

```{r}
overall_res |> 
  filter(year == "2004-05" | year == "2020-21") |> 
  dgnpop(pop="year", 
       factors=c("prevalence"),id_vars=c("gender","age"),
       crossclassified="number_of_offenders") |> 
  dg_table() |> 
  knitr::kable()
```


## More results

```{r}

scot_res <- 
dgnpop(overall_res,
         pop="year", 
         factors=c("prevalence"),id_vars=c("gender","age"),
         crossclassified="number_of_offenders")

scot_res_rates <- 
scot_res$rates |> 
  as_tibble() |> 
  mutate(country = "Scotland")

 scot_res_rates |>  
  ggplot(aes(x=pop,y=rate,col=factor, group = factor))+
  geom_path()+
  theme_bw()


```